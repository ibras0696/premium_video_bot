from config import REFFER_LINK
from keyboards import inline_keyboard_buttons
from database import CrudeUser, CrudeSubscriptions, Subscriptions, CrudePayments


# Кнопка старт
start_text = '👋 Приветствую тебя, друг! Добро пожаловать в моего Telegram-бота по продаже авторских курсов 🎓📚'

# После кнопки старт
ref_and_course_text = '🔗 Ниже ты найдешь свою реферальную ссылку и доступные обучающие курсы ⬇️'

# Реферальная ссылка
async def refer_id_text(telegram_id: int) -> str:
    conn = CrudeUser()
    user_ref_ids = await conn.get_users_by_referral(telegram_id)
    # Пользователь
    user = await conn.get_user(telegram_id)
    # Объект платежей
    payments_user = await CrudePayments().get_all_payments_and_user(referral_id=telegram_id)

    cont_users = len(user_ref_ids) if user_ref_ids else 0
    return (f'📨 Твоя персональная реферальная ссылка:\n{REFFER_LINK}{telegram_id}'
            f'\nОбщее количество приглашенных: {cont_users}'
            f'\nОбщее количество покупок от приглашенных: {len(payments_user) if payments_user else 0}'
            f'\nБаланс: {user.balance}')

# КБ при нажатии "Хочу Курс"
course_text = '📘 Выбери нужный курс ниже, чтобы узнать больше и сразу начать обучение! 🚀'

# Функция для получения текста о профиле
async def get_profile_text(telegram_id: int) -> None | str:
    sub_con = await CrudeSubscriptions().get_all_user_subscriptions(telegram_id)
    user = await CrudeUser().get_user(telegram_id)
    if user:
        txt_user = (
            f'🆔 Уникальный ID: {user.id}'
            f'\n👤 Telegram ID: {user.telegram_id}'
            f'\n📛 Имя пользователя: {user.user_name}'
            f'{f"\n🤝 Пригласивший (реф ID): {user.referral_id}" if user.referral_id else ""}'
            f'\n💰 Баланс: {user.balance} ⭐'
        )
        data_plans = Subscriptions.get_plans()
        links = Subscriptions.get_group_link()

        if sub_con and sub_con:
            sub_text = ''
            for sub in sub_con:
                if sub.day_count > 0:
                    sub_text += (
                        f'\n\n📅 Подписка от: {sub.day}.{sub.month}.{sub.year}'
                        f'\n📦 Тариф: {data_plans.get(sub.plan)}'
                        f'\n👤 Группа: {links.get(sub.plan)}'
                        f'\n📆 Кол-во дней: {sub.day_count}'
                    )
            txt_user += sub_text  # <--- Была ошибка здесь, раньше результат не добавлялся

        return txt_user
    else:
        return None

# Курсы
base_course_text = '''
🟢 Тариф “Базовый”

🔓 Полный доступ к крипто-функциям Telegram — даже если есть ограничения!
 • ✅ Пошаговая верификация в Telegram-кошельке
 • 💸 Покупка криптовалюты за рубли — прямо внутри Telegram
 • 🤝 Продажа крипты за рубли через P2P-сделки в Telegram
 • 🔄 Обмен криптовалюты без выхода из Telegram
 • 🚫 Если ваш кошелёк заблокирован или вам нет 18 — покажем, как обойти любые ограничения и пользоваться всеми функциями
 • 🌍 Не из РФ? Научим обменивать крипту на нужную вам валюту в любой стране

🟩 Telegram для всех — без исключений и ограничений!
'''
advanced_course_text = '''
🟡 Тариф “Продвинутый”

⭐ Уникальные Telegram-функции: премиум, звёзды и аукционы — по лучшим ценам!
 • 💎 Доступ к Telegram Premium и звёздам — по самым выгодным расценкам
 • 🎁 Покупка премиума и звёзд для себя или в подарок другим пользователям
 • 🏷️ Выставление своего уникального username на аукцион
 • 🔢 Продажа эксклюзивного Telegram-номера
 • 🧭 Подробная регистрация на платформе, которую мы изучаем
 • 🔐 Подключение любых кошельков с учётом всех технических нюансов
 • 🛍️ Покупка любых позиций с аукциона — безопасно и выгодно

🟡 Максимум Telegram — без переплат и с гарантией!
'''
exclusive_course_text = '''
🔥 Тариф “Эксклюзивный”

🦈 Полный гайд по Telegram NFT и аукционам — от новичка до акула рынка!
 • 🎨 Отличие обычного подарка от настоящего NFT — раз и навсегда
 • 🛒 Покупка NFT-подарков: как, где и зачем
 • 🔍 Определение редких и дорогих NFT в Telegram
 • 📤 Передача NFT другим пользователям
 • 📈 Мониторинг рыночных цен
 • 💰 Правильная продажа NFT
 • 💸 Гибкое изменение цены
 • 🧾 Покупка чужих NFT — безопасно и быстро
 • 🏷️ Выставление своих NFT на аукцион
 • 🎯 Участие в аукционах Telegram
 • 🤖 Создание ордеров на автоматическую покупку
 • 🦈 Стратегия роста: как стать “акулой” в нише NFT-подарков

🔥 Полный контроль. Реальные сделки. Telegram как бизнес
'''
all_course_text = '''
🏆 ТАРИФ “ВСЁ СРАЗУ”

✨ Максимум знаний. Все фишки. Один тариф.

⸻

💰 КРИПТА В TELEGRAM — БЕЗ ОГРАНИЧЕНИЙ
 • 🛡️ Верификация и запуск кошелька
 • 💸 Покупка/продажа крипты за рубли
 • 🔁 P2P-обмен внутри Telegram
 • 🚫 Обход блокировок (если нет 18 или бан)
 • 🌍 Поддержка любых стран и валют

⸻

🌟 PREMIUM + ЗВЁЗДЫ — ВЫГОДНО И ЛЕГКО
 • ⭐ Premium и звёзды по самым низким ценам
 • 🎁 Как дарить премиум/звёзды другим
 • 🏷️ Аукционы: юзернейм и уникальный номер
 • 🔗 Подключение любых кошельков без ошибок
 • 🛡️ Работаем безопасно — на практике

⸻

🔥 NFT + АУКЦИОНЫ — ПОЛНОЕ ПОГРУЖЕНИЕ
 • 🎨 Отличие обычных подарков от настоящих NFT
 • 🧩 Как покупать, продавать и дарить NFT
 • 📊 Мониторинг цен в Telegram
 • 🛍️ Выставление на аукцион + участие
 • 🤖 Создание ордеров на авто-покупку
 • 🦈 Стратегия: как стать «акулой» в нише NFT

⸻

🎁 В ОДНОМ ТАРИФЕ ТЫ ПОЛУЧАЕШЬ:

✅ Всё из базового, продвинутого и эксклюзивного
✅ Личный гайд + поддержка
✅ Пожизненный доступ
✅ Самую полную прокачку Telegram-функций

⸻

📣 Вывод: хочешь всё и сразу — бери ВСЁ.
🔓 Открываешь все двери. Без ограничений.
🚀 Стартуй как профи.
'''

# КБ покупки курса
pay_course_text = '💳 Оплата курса:\nВыберите курс, оплатите его звёздами ⭐ и получите доступ к материалам!'

# Меню оплаты
pay_time_text = 'Меню Оплаты'
# покупка курса
accept_course_text = 'Ты успешно купил курс\n'

support_message_text = (f'Техническая поддержка'
                        f'\nНик')


pay_take_text = 'Панель снятия денег!'


# Пуш уведомление о оканчиваюшей подписке
async def push_subs_text(day: int, plan: str):
    return (f'У вас заканчивается подписка {plan}'
            f'Осталось {day} дней')